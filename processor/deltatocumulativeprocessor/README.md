# Delta to Cumulative Processor
<!-- status autogenerated section -->
| Status        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| ------------- |-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Stability     | [development]: metrics                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Distributions | [contrib]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Warnings      | [Statefulness](#warnings)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Issues        | [![Open issues](https://img.shields.io/github/issues-search/open-telemetry/opentelemetry-collector-contrib?query=is%3Aissue%20is%3Aopen%20label%3Aprocessor%2Fdeltatocumulative%20&label=open&color=orange&logo=opentelemetry)](https://github.com/open-telemetry/opentelemetry-collector-contrib/issues?q=is%3Aopen+is%3Aissue+label%3Aprocessor%2Fdeltatocumulative) [![Closed issues](https://img.shields.io/github/issues-search/open-telemetry/opentelemetry-collector-contrib?query=is%3Aissue%20is%3Aclosed%20label%3Aprocessor%2Fdeltatocumulative%20&label=closed&color=blue&logo=opentelemetry)](https://github.com/open-telemetry/opentelemetry-collector-contrib/issues?q=is%3Aclosed+is%3Aissue+label%3Aprocessor%2Fdeltatocumulative) |
| [Code Owners](https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/CONTRIBUTING.md#becoming-a-code-owner)    | N/A                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |

[development]: https://github.com/open-telemetry/opentelemetry-collector#beta
[contrib]: https://github.com/open-telemetry/opentelemetry-collector-releases/tree/main/distributions/otelcol-contrib
<!-- end autogenerated section -->

## Description

The delta to cumulative processor (`deltatocumulativeprocessor`) converts monotonic, delta sum ~~and histogram~~ metrics to monotonic, cumulative metrics. Non-monotonic sums and exponential histograms are excluded.

## Configuration

~~Configuration is specified through a list of metrics. The processor uses metric names to identify a set of delta metrics and converts them from delta to cumulative.~~

The following settings can be optionally configured:

- TODO ~~`include`: List of metrics names or patterns to convert to cumulative.~~
- TODO ~~`exclude`: List of metrics names or patterns to not convert to cumulative.  **If a metric name matches both include and exclude, exclude takes precedence.**~~
- `max_staleness`: The total time a state entry will live past the time it was last seen. Set to 0 to retain state indefinitely. Default: 180 minutes
- `send_interval`: How frequently to emit the cumulative metrics. Default: 30 seconds
- `identity_mode`: How to create a metrics identity signature. Options are
  - `SCOPE_AND_RESOURCE_ATTRIBUTES`: Use both the metrics `scope` and `resource` attributes
  - `SCOPE_ATTRIBUTES_ONLY`: Use only the metrics `scope` attributes
  - n.b., if metrics will be exported wit the `prometheus` or `prometheus remote write` exporters, this should be set to work will with the exporter's `resource_to_telemetry_conversion` configuration
- `level`: For development use. Level at which to log events.  If set to `detailed`, events are logged at `INFO`, otherwise `DEBUG`

TODO  ~~If neither include nor exclude are supplied, no filtering is applied.~~

## Metrics
The following metrics are published:

- `timeseries.added`: Increments each time a new metric identity starts to be tracked.
- `timeseries.removed`: Increments each time an old new metric identity is no longer tracked.  `reason` can be `expired` or `stale`.
- `datapoint.dropped`: Increments each time a datapoint is dropped (and ignored). `reason` can be `late`

## Warnings

- [Statefulness](https://github.com/open-telemetry/opentelemetry-collector/blob/main/docs/standard-warnings.md#statefulness): The deltatocumulative processor's calculates cumulative by keeping a sum value of a metric.  For this reason, the calculation is only accurate if the metric is continuously sent to the same instance of the collector.  As a result, the deltatocumulative processor may not work as expected if used in a deployment of multiple collectors.  When using this processor it is best for the data source to being sending data to a single collector. It would be nice to add metric identity routing key support to the loadbalancer exporter.


[development]: https://github.com/open-telemetry/opentelemetry-collector#development
[contrib]: https://github.com/open-telemetry/opentelemetry-collector-releases/tree/main/distributions/otelcol-contrib
